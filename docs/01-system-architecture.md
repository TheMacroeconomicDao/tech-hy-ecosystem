# Архитектура системы

## Общая архитектура

Архитектура экосистемы токенов VC/VG на Solana представляет собой набор взаимосвязанных программ (смарт-контрактов), обеспечивающих функционирование всех компонентов экосистемы. Система разработана с учетом требований безопасности, масштабируемости и оптимизации использования вычислительных ресурсов Solana.

## Компоненты системы

Система состоит из трех основных групп компонентов:

1. **Token Contracts** - контракты для управления токенами
2. **Program Contracts** - программы для реализации бизнес-логики
3. **External Integrations** - интеграции с внешними сервисами

### 1. Token Contracts

#### 1.1 VC Token (SPL Token без налога)

Основной токен экосистемы, не облагаемый налогом при транзакциях.

- **Особенности**: 
  - Стандартный SPL токен
  - Нулевой налог на транзакции (0%)
  - Используется для создания LP токенов и стейкинга для получения NFT-бустеров

#### 1.2 VG Token (SPL Token с налогом 10%)

Governance токен с налогом на транзакции, который используется для управления экосистемой через DAO.

- **Особенности**:
  - SPL токен с модифицированной логикой транзакций
  - Налог 10% на все транзакции
  - Распределение налога:
    - 50% для держателей NFT Fee Key
    - 30% для обратного выкупа и сжигания VC
    - 20% для казны DAO

#### 1.3 LP Token (SPL Token для пары VC/SOL)

Токен ликвидности, создаваемый через Raydium путем объединения VC токенов и SOL в пул ликвидности.

- **Особенности**:
  - Стандартный LP токен Raydium
  - Постоянная блокировка в механизме "Burn and Earn"
  - Пропорциональная выдача VG токенов за блокировку

### 2. Program Contracts

#### 2.1 LP Formation Program

Программа для конвертации VC в LP токены с последующей постоянной блокировкой и получением VG токенов и NFT Fee Key.

- **Основные функции**:
  - Разделение VC токенов на две части
  - Обмен части VC на SOL через Raydium
  - Создание LP токенов и их блокировка
  - Выдача VG токенов и NFT Fee Key

#### 2.2 VC Staking Program

Программа для стейкинга VC токенов и создания NFT-бустеров.

- **Основные функции**:
  - Блокировка фиксированной суммы VC токенов (1 млн)
  - Создание NFT-бустера через Metaplex
  - Контроль периода стейкинга и вывода токенов

#### 2.3 VG Staking Program

Программа для стейкинга VG токенов с применением NFT-бустеров и автоматическим реинвестированием.

- **Основные функции**:
  - Блокировка VG токенов на динамический период
  - Применение NFT-бустеров для сокращения периода стейкинга
  - Автоматическое реинвестирование при большом размере стейка

#### 2.4 NFT Fee Key Program

Программа для управления NFT Fee Key, дающими право на доход от комиссий.

- **Основные функции**:
  - Создание NFT Fee Key с определенным уровнем
  - Расчет доли в пуле комиссий
  - Вывод накопленного вознаграждения

#### 2.5 Governance Program

Программа для интеграции с Realms и реализации функций управления экосистемой.

- **Основные функции**:
  - Создание и выполнение предложений
  - Голосование держателей VG токенов
  - Обновление параметров экосистемы через DAO

### 3. External Integrations

#### 3.1 Raydium Integration

Интеграция с Raydium для создания пулов ликвидности и обмена токенов.

- **Используемые функции**:
  - Создание пулов ликвидности
  - Обмен VC на SOL
  - Добавление ликвидности и создание LP токенов

#### 3.2 Metaplex Integration

Интеграция с Metaplex для создания и управления NFT.

- **Используемые функции**:
  - Создание NFT-бустеров
  - Создание NFT Fee Key
  - Обновление метаданных NFT

#### 3.3 Realms Integration

Интеграция с Realms для реализации DAO.

- **Используемые функции**:
  - Создание и управление DAO
  - Предложения и голосования
  - Выполнение одобренных предложений

## Взаимодействие компонентов

### Механизм "Burn and Earn"

```
[Пользователь] ---(VC токены)---> [LP Formation Program] ---(LP токены)---> [Permanent Lock Vault]
                                          |                                           |
                                          v                                           v
                                    [Raydium Exchange]                    [VG токены + NFT Fee Key] ---> [Пользователь]
```

### Стейкинг VC токенов

```
[Пользователь] ---(VC токены)---> [VC Staking Program] ---(NFT-бустер)---> [Пользователь]
                                          |
                                          v
                                   [Metaplex NFT Creation]
```

### Стейкинг VG токенов

```
[Пользователь] ---(VG токены + NFT-бустер)---> [VG Staking Program]
                                                       |
                                                       v
                               [Реинвестирование 70%] <-+-> [Вывод 30%] ---> [Пользователь]
                                       |
                                       v
                            [Новый период стейкинга]
```

### Governance процесс

```
[Держатель VG] ---(Предложение)---> [Realms DAO] ---(Голосование)---> [Выполнение] ---> [Обновление параметров]
```

## Технологический стек

Экосистема токенов VC/VG разрабатывается с использованием следующих технологий:

- **Блокчейн**: Solana
- **Язык программирования**: Rust
- **Фреймворк**: Anchor
- **Токен-стандарт**: SPL Token
- **NFT-стандарт**: Metaplex NFT Standard
- **AMM**: Raydium
- **Governance**: Realms DAO

## Диаграмма компонентов

```
+---------------------+     +----------------------+     +----------------------+
|                     |     |                      |     |                      |
|   Token Contracts   |<--->|   Program Contracts  |<--->|  External Services   |
|                     |     |                      |     |                      |
+---------------------+     +----------------------+     +----------------------+
         |                            |                            |
         v                            v                            v
+---------------------+     +----------------------+     +----------------------+
|                     |     |                      |     |                      |
|   VC Token (SPL)    |     |  LP Formation Program|     |      Raydium AMM     |
|   VG Token (SPL)    |     |  VC Staking Program  |     |     Metaplex NFT     |
|   LP Token (SPL)    |     |  VG Staking Program  |     |     Realms DAO       |
|                     |     |  NFT Programs        |     |                      |
+---------------------+     +----------------------+     +----------------------+
```

## Требования к безопасности

Система разработана с учетом следующих требований к безопасности:

1. **Безопасное хранение данных**:
   - Использование Program Derived Addresses (PDA) для хранения данных
   - Многоуровневая проверка подписей транзакций

2. **Защита от атак**:
   - Защита от атак типа reentrancy
   - Проверка входных данных и лимитов
   - Защита от манипуляций с ценами токенов

3. **Оптимизация ресурсов**:
   - Минимизация количества инструкций в транзакциях
   - Оптимизация сериализации/десериализации данных
   - Эффективное использование хранилища аккаунтов

## Дальнейшие материалы

- [Токены экосистемы](./02-tokens.md)
- [Механизм "Burn and Earn"](./03-burn-and-earn.md)
- [Структуры данных](./specs/data-structures.md)
- [План реализации](./10-implementation-plan.md) 