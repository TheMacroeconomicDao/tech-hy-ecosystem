# Архитектура системы

## Общая архитектура

Архитектура экосистемы токенов VC/VG на Solana представляет собой набор взаимосвязанных программ (смарт-контрактов), обеспечивающих функционирование всех компонентов экосистемы. Система разработана с учетом требований безопасности, масштабируемости и оптимизации использования вычислительных ресурсов Solana.

## Компоненты системы

Система состоит из трех основных групп компонентов:

1. **Token Contracts** - контракты для управления токенами
2. **Program Contracts** - программы для реализации бизнес-логики
3. **External Integrations** - интеграции с внешними сервисами

### 1. Token Contracts

#### 1.1 VC Token (SPL Token без налога)
- Стандартный SPL токен
- Нулевой налог (0%)
- Используется для LP и стейкинга

#### 1.2 VG Token (SPL Token с налогом 10%)
- SPL токен с модифицированной логикой транзакций
- Налог 10% на все транзакции
- Распределение налога:
  - 50% держателям NFT Fee Key
  - 30% обратный выкуп и сжигание VC
  - 20% казна DAO

#### 1.3 LP Token (SPL Token для пары VC/SOL)
- Стандартный LP токен Raydium
- Постоянная блокировка без возможности вывода
- Пропорциональная выдача VG токенов при блокировке

### 2. Program Contracts

#### 2.1 LP Formation Program
- Проверка и управление парой VC/SOL в требуемой пропорции
- Добавление ликвидности в пул Raydium
- Создание и блокировка LP токенов
- Выдача VG токенов и NFT Fee Key

#### 2.2 VC Staking Program
- Блокировка 1 млн VC токенов на 90 дней
- Создание NFT-бустера через Metaplex
- Контроль периода стейкинга и вывода токенов

#### 2.3 VG Staking Program
- Блокировка VG токенов на период, зависящий от количества и NFT-бустера
- Автокомпаундинг при стейке более 10,000 VG
- Применение NFT-бустеров для сокращения периода

#### 2.4 NFT Fee Key Program
- Создание NFT с определенным уровнем (Common, Rare, Epic, Legendary)
- Расчет доли в пуле комиссий по формуле
- Вывод накопленного вознаграждения

#### 2.5 Governance Program
- Интеграция с Realms DAO
- Создание и выполнение предложений
- Голосование и обновление параметров экосистемы

### 3. External Integrations

#### 3.1 Raydium Integration
- Создание пулов ликвидности VC/SOL
- Обмен VC на SOL
- Добавление ликвидности и создание LP токенов

#### 3.2 Metaplex Integration
- Создание NFT-бустеров
- Создание NFT Fee Key
- Обновление метаданных NFT

#### 3.3 Realms Integration
- Создание и управление DAO
- Предложения и голосования
- Выполнение одобренных предложений

## Взаимодействие компонентов

### Механизм "Burn and Earn"
```
[Пользователь] → [VC токены] → [LP Formation Program] → [LP токены] → [Permanent Lock]
                                      ↓
                              [Raydium Exchange] → [VG токены + NFT Fee Key] → [Пользователь]
```

### Стейкинг VC токенов
```
[Пользователь] → [VC токены] → [VC Staking Program] → [NFT-бустер] → [Пользователь]
                                      ↓
                               [Metaplex NFT]
```

### Стейкинг VG токенов
```
[Пользователь] → [VG токены + NFT-бустер] → [VG Staking Program]
                                                  ↓
                          [Реинвестирование 70%] ← + → [Вывод 30%] → [Пользователь]
```

## Технический стек
- Блокчейн: Solana
- Язык программирования: Rust
- Фреймворк: Anchor
- Токен-стандарт: SPL Token
- NFT-стандарт: Metaplex NFT Standard
- AMM: Raydium
- Governance: Realms DAO

## Требования к безопасности
1. **Безопасное хранение данных**:
   - Использование PDA для хранения данных
   - Многоуровневая проверка подписей транзакций

2. **Защита от атак**:
   - Защита от reentrancy атак
   - Проверка входных данных и лимитов
   - Защита от манипуляций с ценами токенов

3. **Оптимизация ресурсов**:
   - Минимизация количества инструкций в транзакциях
   - Оптимизация сериализации/десериализации
   - Эффективное использование хранилища аккаунтов

## Дальнейшие материалы

- [Токены экосистемы](./02-tokens.md)
- [Механизм "Burn and Earn"](./03-burn-and-earn.md)
- [Структуры данных](./specs/data-structures.md)
- [План реализации](./10-implementation-plan.md) 
