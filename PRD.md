# Product Requirements Document: Экосистема токенов VC/VG на Solana

## 1. Обзор продукта

### 1.1 Описание продукта
Многоуровневая токеномическая экосистема на блокчейне Solana, состоящая из двух взаимосвязанных токенов (VC и VG), механизмов стейкинга, NFT-коллекций и децентрализованного управления (DAO).

### 1.2 Ключевые компоненты
- SPL токены: VC (базовый) и VG (governance)
- Механизм "Burn and Earn" для создания LP и эмиссии VG
- Система стейкинга с NFT-бустерами
- Коллекция NFT "Investor's Hand"
- NFT Fee Key для распределения комиссий
- DAO на базе Realms для управления экосистемой

## 2. Бизнес-требования

### 2.1 Бизнес-цели
- Создание устойчивой экономической модели с долгосрочными стимулами для участников
- Обеспечение ликвидности основного токена VC
- Децентрализованное управление параметрами экосистемы
- Справедливое распределение доходов от комиссий между стейкхолдерами

### 2.2 Ключевые метрики успеха
- Объем заблокированных LP токенов
- Количество активных стейкеров VG
- Процент участия в голосованиях DAO
- Стабильность цены VC токена

## 3. Технические требования

### 3.1 Токены
_Подробнее: [02-tokens.md](docs/02-tokens.md)_

#### 3.1.1 VC Token
- Тип: Standard SPL Token
- Налог: 0%
- Функции: трансфер, стейкинг, создание LP

#### 3.1.2 VG Token
- Тип: Modified SPL Token с налогом 10%
- Распределение налога:
  - 50% держателям NFT Fee Key
  - 50% казна DAO
- Функции: трансфер, стейкинг, голосование в DAO

#### 3.1.3 LP Token
- Тип: Raydium LP Token для пары VC/SOL
- Функции: постоянная блокировка, генерация VG и NFT Fee Key

### 3.2 Смарт-контракты

#### 3.2.1 LP Formation Program (Burn and Earn)
_Подробнее: [03-burn-and-earn.md](docs/03-burn-and-earn.md), [Формула расчета VG токенов](docs/specs/vg-calculation-formula.md)_
- Конвертация VC в LP (50% на SOL)
- Постоянная блокировка LP токенов
- Эмиссия VG по формуле: `VG = LP * C * (1 + B * log10(LP/LP_min))`
- Создание NFT Fee Key соответствующего уровня

#### 3.2.2 VC Staking Program
_Подробнее: [04-vc-staking.md](docs/04-vc-staking.md)_
- Блокировка 1 млн VC на 90 дней
- Создание NFT-бустера из коллекции "Investor's Hand"
- Вывод токенов по истечении периода стейкинга

#### 3.2.3 VG Staking Program
_Подробнее: [05-vg-staking.md](docs/05-vg-staking.md), [Формула расчета периода стейкинга](docs/specs/vg-staking-formula.md)_
- Многоуровневая система от Starter до Partner
- Периоды стейкинга от 7 до 365 дней
- Использование NFT-бустеров для сокращения периода
- Автоматическое реинвестирование при стейке > 10,000 VG (100%)

#### 3.2.4 NFT Fee Key Program
_Подробнее: [06-nft-fee-key.md](docs/06-nft-fee-key.md)_
- Четыре уровня: Common, Rare, Epic, Legendary
- Расчет доли в пуле комиссий
- Функции сбора вознаграждения

#### 3.2.5 Governance Program
_Подробнее: [07-governance.md](docs/07-governance.md)_
- Интеграция с Realms DAO
- Управление параметрами экосистемы
- Голосование (мин. 100 VG)
- Создание предложений (мин. 10,000 VG)

### 3.3 NFT-коллекции

#### 3.3.1 Investor's Hand NFT
_Подробнее: [04.5-investors-hand-nft.md](docs/04.5-investors-hand-nft.md.md)_
- Метаданные: 
  ```json
  {
    "name": "[Уровень] Hand NFT #{id}",
    "symbol": "VCIH",
    "description": "NFT из коллекции Investor's Hand для экосистемы VC/VG",
    "image": "https://token-cdn.tech-hy.com/investors-hand/{level}/{id}.png",
    "attributes": [
      {
        "trait_type": "hand_tier",
        "value": "[Paper/Wooden/Steel/Titanium/Diamond]"
      },
      {
        "trait_type": "staked_vc_amount",
        "value": "1000000"
      },
      {
        "trait_type": "stake_timestamp",
        "value": "1650000000"
      },
      {
        "trait_type": "boost_multiplier",
        "value": "[110/125/150/175/200]"
      },
      {
        "trait_type": "dao_tier_access",
        "value": "[Community Member/Founder/Investor/Launchpad Master/Partner]"
      }
    ]
  }
  ```
- Способы получения:
  - Paper Hand: промо-акции и вознаграждения сообщества
  - Wooden Hand: стейкинг 1 млн VC на 90 дней
  - Steel Hand: специальные достижения или вторичный рынок
  - Titanium Hand: выпуск администрацией для крупных инвесторов
  - Diamond Hand: выпуск только для партнеров проекта
  - Angel Investor: участники пресейла с вкладом от 50 SOL
- Уровни бустеров:
  | Уровень | Множитель | Сокращение периода |
  |---------|-----------|-------------------|
  | Paper   | 1.1x      | 10%               |
  | Wooden  | 1.25x     | 25%               |
  | Steel   | 1.5x      | 50%               |
  | Titanium| 1.75x     | 75%               |
  | Diamond | 2.0x      | 100%              |
- Angel NFT (специальный тип): безлимитный период

#### 3.3.2 NFT Fee Key
- Уровни по количеству заблокированных LP
- Метаданные: уровень, доля в комиссиях, количество LP
- Передаваемый NFT

### 3.4 Интеграции

#### 3.4.1 Raydium
- Создание пулов ликвидности VC/SOL
- Обмен VC на SOL
- Управление LP токенами

#### 3.4.2 Metaplex
- Создание и управление NFT
- Хранение метаданных NFT
- Система NFT-авторизаций

#### 3.4.3 Realms
- Создание DAO
- Система предложений и голосований
- Выполнение решений DAO

## 4. Уровни DAO и доступ

| Уровень         | Требования                       | Период стейкинга | Права                          |
|-----------------|----------------------------------|------------------|--------------------------------|
| Starter         | до 100 VG                        | 7 дней           | Пассивное участие              |
| Community Member| 100-500 VG                       | 14 дней          | Базовое голосование            |
| Contributor     | 500-1500 VG                      | 30 дней          | Аирдропы и награды             |
| Founder         | 1500-4000 VG                     | 60 дней          | Номинирование проектов         |
| Expert          | 4000-25000 VG                    | 90 дней          | Минтинг NFT Marketplace        |
| Angel           | Angel Investor NFT               | Безлимитный      | Ежедневный автокомпаундинг     |
| Investor        | 25000-50000 VG + Steel Hand NFT  | 365 дней         | Еженедельный автокомпаундинг   |
| Launchpad Master| 50000-70000 VG + Titanium Hand   | 365 дней         | Доля комиссий Launchpad        |
| Partner         | >70000 VG + Diamond Hand         | 365 дней         | Право вето, Совет директоров   |

## 5. Безопасность
_Подробнее: [09-security.md](docs/09-security.md)_

### 5.1 Требования к безопасности
- Защита от reentrancy атак
- Контроль доступа к функциям смарт-контрактов
- Использование PDA (Program Derived Address)
- Многоуровневая проверка подписей
- Защита от переполнения целочисленных значений:
  - Использование безопасных математических операций
  - Проверка результатов арифметических операций
- Защита от повторного использования транзакций (Transaction Replay):
  - Использование уникальных nonce для каждой транзакции
  - Проверка, что транзакция не была выполнена ранее
- Защита от фронтраннинга (Frontrunning):
  - Использование атомарных транзакций
  - Добавление случайного значения к параметрам транзакций
- Защита от атак на оракулы и внешние интеграции:
  - Использование нескольких источников данных
  - Проверка корректности данных перед использованием

### 5.2 Аварийное управление
- Мультисигнатура (5-7 ключевых участников)
- Требуется 2/3 подписей для экстренных мер
- Право вето имеют только:
  - TECH HY (временно, до полной децентрализации)
  - Партнеры (уровень Partner) DAO
- Механизм аварийной остановки:
  - Проверка авторизации через мультиподпись
  - Установка флага паузы с указанием причины
  - Эмиссия события об аварийной остановке

### 5.3 План аудита безопасности
- Предварительный внутренний аудит: после разработки базовых контрактов
- Промежуточный внутренний аудит: после разработки основных компонентов
- Комплексный внешний аудит: перед запуском в тестовой сети
- Постаудит и непрерывный мониторинг: после запуска в основной сети

## 6. Пользовательские интерфейсы

### 6.1 Функциональность интерфейса
- Стейкинг VC и VG токенов
- Использование механизма "Burn and Earn"
- Управление NFT-бустерами
- Участие в голосованиях DAO
- Сбор комиссий с NFT Fee Key

### 6.2 Требования к UX/UI
- Интуитивно понятный интерфейс
- Мобильная адаптивность
- Отображение статусов транзакций
- Информационные панели для статистики
- Интеграция с кошельками Solana

## 7. План разработки
_Подробнее: [10-implementation-plan.md](docs/10-implementation-plan.md)_

### 7.1 Фазы разработки
1. **Подготовка и проектирование** (2 дня)
   - Детализация архитектуры системы
   - Проектирование структур данных
   - Создание тестовой среды
   - Настройка инфраструктуры разработки

2. **Разработка базовых токенов** (4 дня)
   - Разработка VC токена без налога
   - Разработка VG токена с налогом 10%
   - Тестирование базовых функций токенов

3. **Разработка механизма "Burn and Earn"** (6 дней)
   - Интеграция с Raydium для обмена VC на SOL
   - Реализация постоянной блокировки LP токенов
   - Разработка механизма эмиссии VG токенов

4. **Разработка стейкинга VC и NFT-бустеров** (5 дней)
   - Реализация стейкинга VC токенов
   - Интеграция с Metaplex для создания NFT-бустеров
   - Разработка логики блокировки токенов

5. **Разработка NFT Fee Key и распределения комиссий** (4 дня)
   - Разработка механизма создания NFT Fee Key
   - Реализация системы уровней NFT
   - Реализация механизма распределения комиссий

6. **Разработка стейкинга VG токенов** (6 дней)
   - Реализация стейкинга VG токенов
   - Разработка логики применения NFT-бустеров
   - Реализация динамического периода стейкинга

7. **Интеграция с DAO** (7 дней)
   - Интеграция с Realms для создания DAO
   - Разработка механизмов управления экосистемой
   - Реализация системы предложений и голосования

8. **Тестирование и оптимизация** (5 дней)
   - Комплексное тестирование всех компонентов
   - Оптимизация использования вычислительных единиц
   - Аудит безопасности смарт-контрактов

9. **Деплой и запуск в тестовой сети** (3 дня)
   - Деплой контрактов в тестовую сеть Solana
   - Тестирование в реальных условиях
   - Финальные корректировки

10. **Запуск в основной сети** (3 дня)
    - Деплой контрактов в основную сеть Solana
    - Мониторинг работы системы
    - Поддержка пользователей

**Общая продолжительность**: 45 дней

### 7.2 Приоритеты
1. Высокий приоритет: базовые токены, механизм "Burn and Earn", безопасность
2. Средний приоритет: стейкинг VC и VG, NFT-системы
3. Низкий приоритет: DAO, дополнительные интерфейсы

## 8. Нормативные требования

### 8.1 Соответствие требованиям
- Соответствие стандартам SPL Token
- Соответствие требованиям Solana для эффективного использования ресурсов
- Безопасное управление пользовательскими активами

### 8.2 Аудит
- Обязательный аудит смарт-контрактов независимыми специалистами
- Тестирование на проникновение
- Анализ векторов атак

## 9. Критерии успеха и условия сдачи

### 9.1 Критерии успеха
- Все смарт-контракты успешно прошли аудит
- Задержка транзакций не превышает 1 секунду
- Успешное прохождение тестов на все функциональные возможности
- Корректное взаимодействие с внешними интеграциями

### 9.2 Условия сдачи
- Полное документирование кода и API
- Успешный запуск в тестовой сети в течение не менее 2 недель
- Миграция на основную сеть без потери данных
- Передача всех необходимых ключей и доступов

## 10. API и интерфейсы
_Подробнее: [08-api.md](docs/08-api.md)_

### 10.1 API основных контрактов

#### VC Token API
- `initialize`: Инициализация токена VC
- `mint_to`: Выпуск новых VC токенов
- `transfer`: Перевод VC токенов без налога
- `burn`: Сжигание VC токенов
- `approve`: Авторизация третьей стороны для использования токенов
- `revoke`: Отзыв авторизации

#### VG Token API
- `initialize`: Инициализация токена VG с налогом
- `mint_to`: Выпуск новых VG токенов
- `transfer`: Перевод VG токенов с учетом налога
- `update_tax_parameters`: Обновление параметров налогообложения
- `distribute_tax`: Распределение собранного налога

#### Burn and Earn API
- `convert_vc_to_lp_and_lock`: Конвертация VC в LP токены с постоянной блокировкой
- `calculate_expected_vg`: Расчет ожидаемого количества VG токенов

#### VC Staking API
- `stake_vc`: Стейкинг 1 млн VC токенов и создание NFT-бустера
- `unstake_vc`: Вывод VC токенов после окончания периода стейкинга
- `get_nft_booster_info`: Получение информации о NFT-бустере

#### VG Staking API
- `stake_vg`: Стейкинг VG токенов с опциональным NFT-бустером
- `unstake_vg`: Вывод VG токенов после окончания периода стейкинга
- `calculate_staking_period`: Расчет периода стейкинга
- `apply_nft_booster`: Применение NFT-бустера к существующему стейкингу

#### NFT Fee Key API
- `create_fee_key`: Создание NFT Fee Key
- `claim_fee_rewards`: Сбор накопленного вознаграждения
- `update_fee_shares`: Обновление долей в пуле комиссий

#### DAO API
- `create_dao_realm`: Создание DAO через Realms
- `create_proposal`: Создание предложения для голосования
- `cast_vote`: Голосование за или против предложения
- `execute_proposal`: Выполнение принятого предложения
- `fund_treasury`: Пополнение казны DAO
- `spend_treasury_funds`: Использование средств казны

### 10.2 События (Events)
- `VcTokenTransferred`: Перевод VC токенов
- `VgTokenTransferred`: Перевод VG токенов
- `LpTokensLocked`: Блокировка LP токенов
- `VcStaked`: Стейкинг VC токенов
- `VgStaked`: Стейкинг VG токенов
- `FeeRewardsClaimed`: Сбор вознаграждений за комиссии
- `ProposalCreated`: Создание предложения
- `ProposalExecuted`: Выполнение предложения

## 11. Связанные документы

Для более подробной информации по каждому компоненту системы обратитесь к следующим документам:

- [01-system-architecture.md](docs/01-system-architecture.md) - Подробная архитектура системы
- [02-tokens.md](docs/02-tokens.md) - Детальное описание токенов экосистемы
- [03-burn-and-earn.md](docs/03-burn-and-earn.md) - Подробный механизм "Burn and Earn"
- [04-vc-staking.md](docs/04-vc-staking.md) - Стейкинг VC токенов
- [04.5-investors-hand-nft.md](docs/04.5-investors-hand-nft.md.md) - NFT-коллекция "Investor's Hand"
- [05-vg-staking.md](docs/05-vg-staking.md) - Стейкинг VG токенов
- [06-nft-fee-key.md](docs/06-nft-fee-key.md) - NFT Fee Key и распределение комиссий
- [07-governance.md](docs/07-governance.md) - Governance и DAO
- [08-api.md](docs/08-api.md) - Полная спецификация API и интерфейсов
- [09-security.md](docs/09-security.md) - Безопасность и аудит контрактов
- [10-implementation-plan.md](docs/10-implementation-plan.md) - Детальный план реализации

### Технические спецификации

- [specs/data-structures.md](docs/specs/data-structures.md) - Структуры данных
- [specs/vg-calculation-formula.md](docs/specs/vg-calculation-formula.md) - Формула расчета VG токенов
- [specs/vg-staking-formula.md](docs/specs/vg-staking-formula.md) - Формула расчета периода стейкинга VG 