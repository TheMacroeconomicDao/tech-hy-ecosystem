# Product Requirements Document: Экосистема токенов VC/VG на Solana

## 1. Обзор продукта

### 1.1 Описание продукта
Многоуровневая токеномическая экосистема на блокчейне Solana, состоящая из двух взаимосвязанных токенов (VC и VG), механизмов стейкинга, NFT-коллекций и децентрализованного управления (DAO).

### 1.2 Ключевые компоненты
- SPL токены: VC (базовый) и VG (governance)
- Механизм "Burn and Earn" для создания LP и эмиссии VG
- Система стейкинга с NFT-бустерами
- Коллекция NFT "Investor's Hand"
- NFT Fee Key для распределения комиссий
- DAO на базе Realms для управления экосистемой

## 2. Бизнес-требования

### 2.1 Бизнес-цели
- Создание устойчивой экономической модели с долгосрочными стимулами для участников
- Обеспечение ликвидности основного токена VC
- Децентрализованное управление параметрами экосистемы
- Справедливое распределение доходов от комиссий между стейкхолдерами

### 2.2 Ключевые метрики успеха
- Объем заблокированных LP токенов
- Количество активных стейкеров VG
- Процент участия в голосованиях DAO
- Стабильность цены VC токена

## 3. Технические требования

### 3.1 Токены
_Подробнее: [02-tokens.md](docs/02-tokens.md)_

#### 3.1.1 VC Token
- Тип: Standard SPL Token
- Налог: 0%
- Функции: трансфер, стейкинг, создание LP

#### 3.1.2 VG Token
- Тип: Modified SPL Token с налогом 10%
- Распределение налога:
  - 50% держателям NFT Fee Key
  - 30% обратный выкуп и сжигание VC
  - 20% казна DAO
- Функции: трансфер, стейкинг, голосование в DAO

#### 3.1.3 LP Token
- Тип: Raydium LP Token для пары VC/SOL
- Функции: постоянная блокировка, генерация VG и NFT Fee Key

### 3.2 Смарт-контракты

#### 3.2.1 LP Formation Program (Burn and Earn)
_Подробнее: [03-burn-and-earn.md](docs/03-burn-and-earn.md), [Формула расчета VG токенов](docs/specs/vg-calculation-formula.md)_
- Конвертация VC в LP (50% на SOL)
- Постоянная блокировка LP токенов
- Эмиссия VG по формуле: `VG = LP * C * (1 + B * log10(LP/LP_min))`
- Создание NFT Fee Key соответствующего уровня

#### 3.2.2 VC Staking Program
_Подробнее: [04-vc-staking.md](docs/04-vc-staking.md)_
- Блокировка 1 млн VC на 90 дней
- Создание NFT-бустера из коллекции "Investor's Hand"
- Вывод токенов по истечении периода стейкинга

#### 3.2.3 VG Staking Program
_Подробнее: [05-vg-staking.md](docs/05-vg-staking.md), [Формула расчета периода стейкинга](docs/specs/vg-staking-formula.md)_
- Многоуровневая система от Starter до Partner
- Периоды стейкинга от 7 до 365 дней
- Использование NFT-бустеров для увеличения эффективной доли в пуле вознаграждений
- Автоматическое реинвестирование при стейке > 10,000 VG (100%)

#### 3.2.4 NFT Fee Key Program
_Подробнее: [06-nft-fee-key.md](docs/06-nft-fee-key.md)_
- Четыре уровня: Common, Rare, Epic, Legendary
- Расчет доли в пуле комиссий
- Функции сбора вознаграждения

#### 3.2.5 Governance Program
_Подробнее: [07-governance.md](docs/07-governance.md)_
- Интеграция с Realms DAO
- Управление параметрами экосистемы
- Голосование (мин. 100 VG)
- Создание предложений (мин. 10,000 VG)

### 3.3 NFT-коллекции

#### 3.3.1 Investor's Hand NFT
_Подробнее: [04.5-investors-hand-nft.md](docs/04.5-investors-hand-nft.md.md)_
- Метаданные: 
  ```json
  {
    "name": "[Уровень] Hand NFT #{id}",
    "symbol": "VCIH",
    "description": "NFT из коллекции Investor's Hand для экосистемы VC/VG",
    "image": "https://token-cdn.tech-hy.com/investors-hand/{level}/{id}.png",
    "attributes": [
      {
        "trait_type": "hand_tier",
        "value": "[Paper/Wooden/Steel/Titanium/Diamond]"
      },
      {
        "trait_type": "staked_vc_amount",
        "value": "1000000"
      },
      {
        "trait_type": "stake_timestamp",
        "value": "1650000000"
      },
      {
        "trait_type": "boost_multiplier",
        "value": "[110/125/150/175/200]"
      },
      {
        "trait_type": "dao_tier_access",
        "value": "[Community Member/Founder/Investor/Launchpad Master/Partner]"
      }
    ]
  }
  ```
- Способы получения:
  - Paper Hand: промо-акции и вознаграждения сообщества
  - Wooden Hand: стейкинг 1 млн VC на 90 дней
  - Steel Hand: специальные достижения или вторичный рынок
  - Titanium Hand: выпуск администрацией для крупных инвесторов
  - Diamond Hand: выпуск только для партнеров проекта
  - Angel Investor: участники пресейла с вкладом от 50 SOL
- Уровни бустеров:
  | Уровень | Множитель | Эффективная доля |
  |---------|-----------|------------------|
  | Paper   | 1.1x      | +10%             |
  | Wooden  | 1.25x     | +25%             |
  | Steel   | 1.5x      | +50%             |
  | Titanium| 1.75x     | +75%             |
  | Diamond | 2.0x      | +100%            |
- Angel NFT (специальный тип): безлимитный период

#### 3.3.2 NFT Fee Key
- Уровни по количеству заблокированных LP
- Метаданные: уровень, доля в комиссиях, количество LP
- Передаваемый NFT

### 3.4 Интеграции

#### 3.4.1 Raydium
- Создание пулов ликвидности VC/SOL
- Обмен VC на SOL
- Управление LP токенами

#### 3.4.2 Metaplex
- Создание и управление NFT
- Хранение метаданных NFT
- Система NFT-авторизаций

#### 3.4.3 Realms
- Создание DAO
- Система предложений и голосований
- Выполнение решений DAO

## 4. Уровни DAO и доступ

| Уровень         | Требования                       | Период стейкинга | Права                          |
|-----------------|----------------------------------|------------------|--------------------------------|
| Starter         | до 100 VG                        | 7 дней           | Пассивное участие              |
| Community Member| 100-500 VG                       | 14 дней          | Базовое голосование            |
| Contributor     | 500-1500 VG                      | 30 дней          | Аирдропы и награды             |
| Founder         | 1500-4000 VG                     | 60 дней          | Номинирование проектов         |
| Expert          | 4000-25000 VG                    | 90 дней          | Минтинг NFT Marketplace        |
| Angel           | Angel Investor NFT               | Безлимитный      | Ежедневный автокомпаундинг     |
| Investor        | 25000-50000 VG + Steel Hand NFT  | 365 дней         | Еженедельный автокомпаундинг   |
| Launchpad Master| 50000-70000 VG + Titanium Hand   | 365 дней         | Еженедельный автокомпаундинг, доля комиссий Launchpad |
| Partner         | >70000 VG + Diamond Hand         | 365 дней         | Право вето, Совет директоров   |

## 5. Безопасность
_Подробнее: [09-security.md](docs/09-security.md)_

### 5.1 Требования к безопасности
- Защита от reentrancy атак
- Контроль доступа к функциям смарт-контрактов
- Использование PDA (Program Derived Address)
- Многоуровневая проверка подписей
- Защита от переполнения целочисленных значений:
  - Использование безопасных математических операций
  - Проверка результатов арифметических операций
- Защита от повторного использования транзакций (Transaction Replay):
  - Использование уникальных nonce для каждой транзакции
  - Проверка, что транзакция не была выполнена ранее
- Защита от фронтраннинга (Frontrunning):
  - Использование атомарных транзакций
  - Добавление случайного значения к параметрам транзакций
- Защита от атак на оракулы и внешние интеграции:
  - Использование нескольких источников данных
  - Проверка корректности данных перед использованием

### 5.2 Аварийное управление
- Мультисигнатура (5-7 ключевых участников)
- Требуется 2/3 подписей для экстренных мер
- Право вето имеют только:
  - TECH HY (временно, до полной децентрализации)
  - Партнеры (уровень Partner) DAO
- Механизм аварийной остановки:
  - Проверка авторизации через мультиподпись
  - Установка флага паузы с указанием причины
  - Эмиссия события об аварийной остановке

### 5.3 План аудита безопасности
- Предварительный внутренний аудит: после разработки базовых контрактов
- Промежуточный внутренний аудит: после разработки основных компонентов
- Комплексный внешний аудит: перед запуском в тестовой сети
- Постаудит и непрерывный мониторинг: после запуска в основной сети

## 6. Пользовательские интерфейсы

### 6.1 Функциональность интерфейса
- Стейкинг VC и VG токенов
- Использование механизма "Burn and Earn"
- Управление NFT-бустерами
- Участие в голосованиях DAO
- Сбор комиссий с NFT Fee Key

### 6.2 Требования к UX/UI
- Интуитивно понятный интерфейс
- Мобильная адаптивность
- Отображение статусов транзакций
- Информационные панели для статистики
- Интеграция с кошельками Solana

## 7. План разработки
_Подробнее: [10-implementation-plan.md](docs/10-implementation-plan.md)_

### 7.1 Фазы разработки
1. **Подготовка и проектирование** (2 дня)
   - Детализация архитектуры системы
   - Проектирование структур данных
   - Создание тестовой среды
   - Настройка инфраструктуры разработки

2. **Разработка базовых токенов** (4 дня)
   - Разработка VC токена без налога
   - Разработка VG токена с налогом 10%
   - Тестирование базовых функций токенов

3. **Разработка механизма "Burn and Earn"** (6 дней)
   - Интеграция с Raydium для обмена VC на SOL
   - Реализация постоянной блокировки LP токенов
   - Разработка механизма эмиссии VG токенов

4. **Разработка стейкинга VC и NFT-бустеров** (5 дней)
   - Реализация стейкинга VC токенов
   - Интеграция с Metaplex для создания NFT-бустеров
   - Разработка логики блокировки токенов

5. **Разработка NFT Fee Key и распределения комиссий** (4 дня)
   - Разработка механизма создания NFT Fee Key
   - Реализация системы уровней NFT
   - Реализация механизма распределения комиссий

6. **Разработка стейкинга VG токенов** (6 дней)
   - Реализация стейкинга VG токенов
   - Разработка логики применения NFT-бустеров
   - Реализация динамического периода стейкинга

7. **Интеграция с DAO** (7 дней)
   - Интеграция с Realms для создания DAO
   - Разработка механизмов управления экосистемой
   - Реализация системы предложений и голосования

8. **Тестирование и оптимизация** (5 дней)
   - Комплексное тестирование всех компонентов
   - Оптимизация использования вычислительных единиц
   - Аудит безопасности смарт-контрактов

9. **Деплой и запуск в тестовой сети** (3 дня)
   - Деплой контрактов в тестовую сеть Solana
   - Тестирование в реальных условиях
   - Финальные корректировки

10. **Запуск в основной сети** (3 дня)
    - Деплой контрактов в основную сеть Solana
    - Мониторинг работы системы
    - Поддержка пользователей

**Общая продолжительность**: 45 дней

### 7.2 Приоритеты
1. Высокий приоритет: базовые токены, механизм "Burn and Earn", безопасность
2. Средний приоритет: стейкинг VC и VG, NFT-системы
3. Низкий приоритет: DAO, дополнительные интерфейсы

## 8. Нормативные требования

### 8.1 Соответствие требованиям
- Соответствие стандартам SPL Token
- Соответствие требованиям Solana для эффективного использования ресурсов
- Безопасное управление пользовательскими активами

### 8.2 Аудит
- Обязательный аудит смарт-контрактов независимыми специалистами
- Тестирование на проникновение
- Анализ векторов атак

## 9. Ограничения и допущения

### 9.1 Технические ограничения

- **Транзакционные лимиты Solana**:
  - Максимальный размер транзакции: 1232 байта
  - Максимальное количество вычислительных единиц: 200,000 CU на транзакцию
  - Максимальное количество аккаунтов в одной транзакции: 64
  
- **Ограничения смарт-контрактов**:
  - Максимальный размер данных аккаунта: 10 МБ
  - Максимальное количество инструкций в одной транзакции: 32
  - Максимальное количество BPF инструкций: 1,400,000 на транзакцию

- **Взаимодействие с внешними сервисами**:
  - Ограниченная пропускная способность Raydium при высокой нагрузке
  - Зависимость от доступности внешних оракулов
  - Задержки при интеграции с Metaplex для создания NFT

### 9.2 Бизнес-ограничения

- **Ликвидность**:
  - Минимальный порог ликвидности для стабильной работы пулов: 100,000 SOL
  - Начальные ограничения на объемы транзакций для предотвращения резких колебаний цены

- **Управление**:
  - Поэтапная децентрализация управления системой
  - Временное наличие административных прав у TECH HY до достижения полной децентрализации

### 9.3 Допущения

- **Блокчейн Solana**:
  - Предполагается стабильная работа блокчейна Solana и его основных служб
  - Предполагается отсутствие значительных изменений в протоколах токенов SPL
  
- **Рыночные условия**:
  - Предполагается наличие достаточного интереса для обеспечения ликвидности
  - Предполагается отсутствие значительных регуляторных ограничений

- **Интеграции**:
  - Предполагается совместимость с Raydium, Metaplex и Realms без существенных изменений в их API
  - Предполагается возможность обновления смарт-контрактов при необходимости

## 10. Диаграммы и схемы

### 10.1 Общая архитектура системы

```
+----------------------------------+
|          Пользователи            |
+----------------------------------+
                |
                v
+----------------------------------+
|         Интерфейс dApp           |
+----------------------------------+
                |
                v
+----------------------------------+
|      Solana Blockchain           |
|                                  |
|  +-----------+  +-----------+    |
|  | VC Token  |  | VG Token  |    |
|  +-----------+  +-----------+    |
|        |             |           |
|        v             v           |
|  +--------------------------+    |
|  |     Основные контракты   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | Burn and Earn      |   |    |
|  | +--------------------+   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | VC Staking         |   |    |
|  | +--------------------+   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | VG Staking         |   |    |
|  | +--------------------+   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | NFT Fee Key        |   |    |
|  | +--------------------+   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | Governance (DAO)   |   |    |
|  | +--------------------+   |    |
|  +--------------------------+    |
|              |                   |
|              v                   |
|  +--------------------------+    |
|  |     Внешние интеграции   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | Raydium            |   |    |
|  | +--------------------+   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | Metaplex           |   |    |
|  | +--------------------+   |    |
|  |                          |    |
|  | +--------------------+   |    |
|  | | Realms             |   |    |
|  | +--------------------+   |    |
|  +--------------------------+    |
+----------------------------------+
```

### 10.2 Схема взаимодействия компонентов

#### Механизм "Burn and Earn"
```
[Пользователь] → [VC токены] → [LP Formation Program] → [LP токены] → [Permanent Lock]
                                      ↓
                              [Raydium Exchange] → [VG токены + NFT Fee Key] → [Пользователь]
```

#### Стейкинг VC токенов
```
[Пользователь] → [VC токены] → [VC Staking Program] → [NFT-бустер] → [Пользователь]
                                      ↓
                               [Metaplex NFT]
```

#### Стейкинг VG токенов
```
[Пользователь] → [VG токены + NFT-бустер] → [VG Staking Program] → [Статус в DAO] → [Управление экосистемой]
                                                 |
                                                 ↓
                                  [Увеличенная эффективная доля] → [Автоматическое реинвестирование]
```

#### Распределение налога VG токена
```
[Транзакция VG] → [Налог 10%] → [Распределение] → [50% NFT Fee Key] → [Владельцы NFT]
                                      |
                                      ↓
                                [50% Казна DAO] → [Управление DAO]
```

## 11. Требования к производительности

### 11.1 Пропускная способность

- **Burn and Earn операции**:
  - Способность обрабатывать минимум 100 операций конвертации VC → LP в минуту
  - Время исполнения операции конвертации: не более 15 секунд (включая подтверждение)

- **Стейкинг операции**:
  - Способность обрабатывать минимум 200 операций стейкинга VC и VG в минуту
  - Время исполнения операции стейкинга: не более 5 секунд (включая подтверждение)

- **NFT операции**:
  - Создание NFT-бустера: не более 10 секунд
  - Создание NFT Fee Key: не более 10 секунд
  - Применение NFT-бустера: не более 5 секунд

- **DAO операции**:
  - Создание предложения: не более 10 секунд
  - Голосование: не более 5 секунд
  - Исполнение предложения: не более 30 секунд

### 11.2 Оптимизация вычислительных единиц

- **Burn and Earn**: не более 150,000 CU на транзакцию
- **Стейкинг VC**: не более 100,000 CU на транзакцию
- **Стейкинг VG**: не более 120,000 CU на транзакцию
- **Создание NFT**: не более 180,000 CU на транзакцию
- **DAO операции**: не более 150,000 CU на транзакцию

### 11.3 Масштабируемость

- Система должна поддерживать до 10,000 активных пользователей без деградации производительности
- Возможность масштабирования для поддержки 100,000+ пользователей с минимальными изменениями
- Способность обрабатывать пиковые нагрузки в 10 раз выше средних значений

### 11.4 Устойчивость

- Доступность системы: 99.9% времени
- Время восстановления после сбоя: не более 10 минут
- Максимально допустимое время простоя при обновлении: 30 минут

## 12. Глоссарий терминов

- **SPL (Solana Program Library)** - стандартная библиотека программ Solana, включающая токен-стандарт
- **PDA (Program Derived Address)** - адрес, производный от программы, используемый для хранения данных в аккаунтах
- **CPI (Cross-Program Invocation)** - механизм вызова функций одного контракта из другого на Solana
- **CU (Compute Unit)** - единица измерения вычислительных ресурсов на блокчейне Solana
- **AMM (Automated Market Maker)** - автоматизированный маркет-мейкер, используется Raydium для обеспечения ликвидности
- **LP (Liquidity Provider) Token** - токен, представляющий долю в пуле ликвидности
- **APY (Annual Percentage Yield)** - годовая доходность с учетом сложного процента
- **DAO (Decentralized Autonomous Organization)** - децентрализованная автономная организация
- **NFT (Non-Fungible Token)** - невзаимозаменяемый токен
- **VC Token** - основной токен экосистемы без налога
- **VG Token** - governance токен экосистемы с налогом 10%
- **Burn and Earn** - механизм конвертации VC в LP с последующей эмиссией VG
- **NFT-бустер** - NFT из коллекции "Investor's Hand", увеличивающий эффективную долю в пуле вознаграждений при стейкинге VG
- **NFT Fee Key** - NFT, предоставляющий право на получение доли от налога VG
- **Raydium** - децентрализованная биржа и AMM на блокчейне Solana
- **Metaplex** - протокол для создания и управления NFT на Solana
- **Realms** - протокол для создания и управления DAO на Solana
- **Anchor** - фреймворк для разработки смарт-контрактов на Solana
- **Автокомпаундинг** - автоматическое реинвестирование начисленных вознаграждений

## 13. Критерии успеха и условия сдачи

### 13.1 Критерии успеха
- Все смарт-контракты успешно прошли аудит
- Задержка транзакций не превышает 1 секунду
- Успешное прохождение тестов на все функциональные возможности
- Корректное взаимодействие с внешними интеграциями

### 13.2 Условия сдачи
- Полное документирование кода и API
- Успешный запуск в тестовой сети в течение не менее 2 недель
- Миграция на основную сеть без потери данных
- Передача всех необходимых ключей и доступов

## 14. API и интерфейсы
_Подробнее: [08-api.md](docs/08-api.md)_

### 14.1 API основных контрактов

#### VC Token API
- `initialize`: Инициализация токена VC
- `mint_to`: Выпуск новых VC токенов
- `transfer`: Перевод VC токенов без налога
- `burn`: Сжигание VC токенов
- `approve`: Авторизация третьей стороны для использования токенов
- `revoke`: Отзыв авторизации

#### VG Token API
- `initialize`: Инициализация токена VG с налогом
- `mint_to`: Выпуск новых VG токенов
- `transfer`: Перевод VG токенов с учетом налога
- `update_tax_parameters`: Обновление параметров налогообложения
- `distribute_tax`: Распределение собранного налога

#### Burn and Earn API
- `convert_vc_to_lp_and_lock`: Конвертация VC в LP токены с постоянной блокировкой
- `calculate_expected_vg`: Расчет ожидаемого количества VG токенов

#### VC Staking API
- `stake_vc`: Стейкинг 1 млн VC токенов и создание NFT-бустера
- `unstake_vc`: Вывод VC токенов после окончания периода стейкинга
- `get_nft_booster_info`: Получение информации о NFT-бустере

#### VG Staking API
- `stake_vg`: Стейкинг VG токенов с опциональным NFT-бустером
- `unstake_vg`: Вывод VG токенов после окончания периода стейкинга
- `calculate_staking_period`: Расчет периода стейкинга
- `apply_nft_booster`: Применение NFT-бустера для увеличения эффективной доли вознаграждений

#### NFT Fee Key API
- `create_fee_key`: Создание NFT Fee Key
- `claim_fee_rewards`: Сбор накопленного вознаграждения
- `update_fee_shares`: Обновление долей в пуле комиссий

#### DAO API
- `create_dao_realm`: Создание DAO через Realms
- `create_proposal`: Создание предложения для голосования
- `cast_vote`: Голосование за или против предложения
- `execute_proposal`: Выполнение принятого предложения
- `fund_treasury`: Пополнение казны DAO
- `spend_treasury_funds`: Использование средств казны

### 14.2 События (Events)
- `VcTokenTransferred`: Перевод VC токенов
- `VgTokenTransferred`: Перевод VG токенов
- `LpTokensLocked`: Блокировка LP токенов
- `VcStaked`: Стейкинг VC токенов
- `VgStaked`: Стейкинг VG токенов
- `FeeRewardsClaimed`: Сбор вознаграждений за комиссии
- `ProposalCreated`: Создание предложения
- `ProposalExecuted`: Выполнение предложения

## 15. Связанные документы

Для более подробной информации по каждому компоненту системы обратитесь к следующим документам:

- [01-system-architecture.md](docs/01-system-architecture.md) - Подробная архитектура системы
- [02-tokens.md](docs/02-tokens.md) - Детальное описание токенов экосистемы
- [03-burn-and-earn.md](docs/03-burn-and-earn.md) - Подробный механизм "Burn and Earn"
- [04-vc-staking.md](docs/04-vc-staking.md) - Стейкинг VC токенов
- [04.5-investors-hand-nft.md](docs/04.5-investors-hand-nft.md.md) - NFT-коллекция "Investor's Hand"
- [05-vg-staking.md](docs/05-vg-staking.md) - Стейкинг VG токенов
- [06-nft-fee-key.md](docs/06-nft-fee-key.md) - NFT Fee Key и распределение комиссий
- [07-governance.md](docs/07-governance.md) - Governance и DAO
- [08-api.md](docs/08-api.md) - Полная спецификация API и интерфейсов
- [09-security.md](docs/09-security.md) - Безопасность и аудит контрактов
- [10-implementation-plan.md](docs/10-implementation-plan.md) - Детальный план реализации

### Технические спецификации

- [specs/data-structures.md](../../docs/specs/data-structures.md) - Структуры данных
- [specs/vg-calculation-formula.md](../../docs/specs/vg-calculation-formula.md) - Формула расчета VG токенов
- [specs/vg-staking-formula.md](../../docs/specs/vg-staking-formula.md) - Формула расчета периода стейкинга VG 